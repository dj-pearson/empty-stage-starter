{
  "project": "EatPal",
  "branchName": "ralph/enterprise-production-readiness",
  "description": "Enterprise & Production Readiness - Harden EatPal (Munch Maker Mate) for production launch by fixing critical bugs, deploying missing edge functions, completing admin features, improving test coverage, adding security hardening, and automating deployment.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Fix TypeScript compilation errors and strict mode violations",
      "description": "As a developer, I want the codebase to compile cleanly with zero TypeScript errors so that we have a reliable type-safe foundation for all subsequent work.",
      "acceptanceCriteria": [
        "Run npx tsc --noEmit and resolve all errors",
        "Replace all uses of 'any' type with proper typed alternatives",
        "Ensure strict mode settings in tsconfig.json are enabled (strict: true, noImplicitAny: true, strictNullChecks: true)",
        "npm run build completes without TypeScript errors",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Remove .bak files and dead code from admin components",
      "description": "As a developer, I want to clean up dead code and backup files so that the codebase is professional and maintainable.",
      "acceptanceCriteria": [
        "Delete src/components/admin/BlogCMSManager-OLD.tsx.bak",
        "Delete src/components/admin/EmailMarketingManager-OLD.tsx.bak",
        "Search for and remove any other .bak files in the project",
        "Search for and remove any unused imports in admin components",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create centralized environment variable validation module",
      "description": "As a developer, I want environment variables validated at startup so that missing or malformed config is caught early rather than causing runtime failures.",
      "acceptanceCriteria": [
        "Create src/lib/env.ts that uses Zod to validate all VITE_ env vars",
        "Validate required vars: VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY",
        "Validate optional vars with correct types: VITE_SENTRY_DSN, VITE_STRIPE_PUBLISHABLE_KEY, VITE_GA_MEASUREMENT_ID, VITE_SENTRY_ENABLED, VITE_FUNCTIONS_URL",
        "Export typed env object for use across the app",
        "Log clear error message if required vars are missing (development only)",
        "Import and call validation in src/main.tsx before app renders",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Create global error boundary with recovery and reporting",
      "description": "As a user, I want the app to gracefully handle unexpected errors with a recovery option so that I don't lose my session when something goes wrong.",
      "acceptanceCriteria": [
        "Create src/components/ErrorBoundary.tsx with React error boundary pattern",
        "Display user-friendly error page with 'Try Again' button that resets state",
        "Report errors to Sentry with component stack trace",
        "Show different UI for development (stack trace) vs production (friendly message)",
        "Wrap top-level App component with ErrorBoundary in src/main.tsx",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Add route-level error boundaries to all page routes",
      "description": "As a user, I want individual page errors to be contained so that a crash on one page doesn't break the entire application.",
      "acceptanceCriteria": [
        "Create src/components/RouteErrorBoundary.tsx that catches errors per route",
        "Display page-specific error UI with navigation to go back or home",
        "Report route errors to Sentry with route path context",
        "Wrap each lazy-loaded route in src/App.tsx with RouteErrorBoundary",
        "Existing Suspense fallbacks remain functional",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Implement API request retry logic with exponential backoff",
      "description": "As a user, I want failed network requests to automatically retry so that transient network issues don't cause data loss.",
      "acceptanceCriteria": [
        "Create src/lib/apiRetry.ts with configurable retry logic",
        "Support exponential backoff: 1s, 2s, 4s (max 3 retries by default)",
        "Only retry on network errors and 5xx status codes, not 4xx",
        "Integrate with Supabase client wrapper for all database operations",
        "Add abort controller support for cancellation",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Create health check API endpoint edge function",
      "description": "As a DevOps engineer, I want a health check endpoint so that monitoring systems can verify the API and database are operational.",
      "acceptanceCriteria": [
        "Create functions/health-check/index.ts edge function",
        "Return JSON with status, timestamp, database connectivity check, and version",
        "Respond within 5 seconds or return degraded status",
        "Add to supabase/config.toml with verify_jwt = false",
        "Return HTTP 200 for healthy, HTTP 503 for degraded",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Deploy calculate-food-similarity edge function",
      "description": "As a user, I want food similarity calculations to work so that the app can suggest similar foods for picky eaters.",
      "acceptanceCriteria": [
        "Create functions/calculate-food-similarity/index.ts implementing food similarity logic",
        "Accept POST body with food_id and return array of similar foods with similarity scores",
        "Use food attributes (category, texture, flavor profile) for similarity matching",
        "Validate JWT token for authenticated access",
        "Return proper error responses for invalid input",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Deploy suggest-foods edge function",
      "description": "As a user, I want AI-powered food suggestions so that I can discover new foods my child might accept.",
      "acceptanceCriteria": [
        "Create functions/suggest-foods/index.ts implementing food suggestion logic",
        "Accept POST body with kid_id, preferences, and allergens",
        "Return array of suggested foods filtered by allergens and preferences",
        "Query kid's food history and safe foods to inform suggestions",
        "Validate JWT token for authenticated access",
        "Handle edge case of no matching suggestions gracefully",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Deploy suggest-recipe edge function",
      "description": "As a user, I want recipe suggestions based on my pantry and kids' preferences so that meal planning is easier.",
      "acceptanceCriteria": [
        "Create functions/suggest-recipe/index.ts implementing recipe suggestion logic",
        "Accept POST body with available_foods, kid_ids, and dietary_restrictions",
        "Return ranked recipe suggestions with match percentage",
        "Filter out recipes containing allergens for specified kids",
        "Validate JWT token for authenticated access",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Deploy ai-meal-plan edge function",
      "description": "As a user, I want AI-generated weekly meal plans so that I can automate meal planning for my family.",
      "acceptanceCriteria": [
        "Create functions/ai-meal-plan/index.ts implementing meal plan generation",
        "Accept POST body with kid_ids, date_range, dietary_restrictions, and preferences",
        "Return structured meal plan with breakfast, lunch, dinner, and snacks per day",
        "Respect allergen restrictions and food preferences per child",
        "Track prompt usage in prompt_templates table for cost monitoring",
        "Validate JWT token for authenticated access",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Deploy create-checkout Stripe edge function",
      "description": "As a user, I want to subscribe to premium plans so that I can access paid features.",
      "acceptanceCriteria": [
        "Create functions/create-checkout/index.ts implementing Stripe checkout session creation",
        "Accept POST body with price_id and user_id",
        "Create Stripe checkout session with success and cancel URLs",
        "Store pending subscription in user_subscriptions table",
        "Validate JWT token for authenticated access",
        "Return checkout session URL for client redirect",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Deploy stripe-webhook edge function",
      "description": "As a system, I need to process Stripe webhook events so that subscription status stays synchronized with payment events.",
      "acceptanceCriteria": [
        "Create functions/stripe-webhook/index.ts implementing Stripe webhook handler",
        "Verify Stripe webhook signature for security",
        "Handle checkout.session.completed event to activate subscriptions",
        "Handle customer.subscription.updated event to sync plan changes",
        "Handle customer.subscription.deleted event to deactivate subscriptions",
        "Handle invoice.payment_failed event to flag past_due subscriptions",
        "Update user_subscriptions table on each event",
        "Return 200 for processed events, 400 for invalid signatures",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Deploy parse-recipe edge function",
      "description": "As a user, I want to import recipes from URLs so that I can quickly add recipes without manual data entry.",
      "acceptanceCriteria": [
        "Create functions/parse-recipe/index.ts implementing recipe URL parsing",
        "Accept POST body with url parameter",
        "Extract recipe name, ingredients, instructions, servings, and nutrition from common recipe sites",
        "Parse JSON-LD structured data (Recipe schema) when available",
        "Fall back to HTML parsing for sites without structured data",
        "Return structured recipe object matching the recipes table schema",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Deploy generate-blog-content edge function",
      "description": "As an admin, I want AI-generated blog content so that we can maintain a consistent publishing schedule.",
      "acceptanceCriteria": [
        "Create functions/generate-blog-content/index.ts implementing blog content generation",
        "Accept POST body with topic, target_keywords, tone, and word_count",
        "Return structured blog post with title, excerpt, body (HTML), and suggested meta tags",
        "Track generation cost in prompt_templates table",
        "No JWT required (internal use, protected by other means)",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Deploy generate-social-content edge function",
      "description": "As an admin, I want AI-generated social media posts so that we can promote blog content across platforms.",
      "acceptanceCriteria": [
        "Create functions/generate-social-content/index.ts implementing social content generation",
        "Accept POST body with blog_post_id or content_summary and target_platforms",
        "Return platform-specific posts (Twitter/X character limit, Instagram caption, Facebook post)",
        "Include relevant hashtag suggestions per platform",
        "Track generation cost in prompt_templates table",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-017",
      "title": "Deploy update-blog-image edge function",
      "description": "As an admin, I want to update blog post featured images so that published content has optimized visuals.",
      "acceptanceCriteria": [
        "Create functions/update-blog-image/index.ts implementing image update logic",
        "Accept POST body with blog_post_id and image_url or image data",
        "Upload image to Supabase Storage bucket",
        "Generate optimized versions (thumbnail, medium, large)",
        "Update blog post record with new image URLs",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-018",
      "title": "Implement login rate limiting in auth flow",
      "description": "As a security engineer, I want login attempts rate-limited so that brute force attacks are mitigated.",
      "acceptanceCriteria": [
        "Create src/lib/rateLimiter.ts with sliding window rate limiter",
        "Limit login attempts to 5 per email per 15-minute window",
        "Store attempt counts in localStorage (client-side) with timestamp",
        "Show remaining attempts and lockout timer in Auth.tsx login form",
        "Clear rate limit on successful login",
        "Display user-friendly 'Too many attempts, please try again in X minutes' message",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 18,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-019",
      "title": "Add server-side rate limiting database table and RLS policies",
      "description": "As a security engineer, I want server-side rate limiting so that rate limits cannot be bypassed by clearing browser storage.",
      "acceptanceCriteria": [
        "Create migration: supabase/migrations/[timestamp]_rate_limiting.sql",
        "Create rate_limits table with columns: id, identifier (email/IP), action, attempt_count, window_start, created_at",
        "Add index on (identifier, action, window_start) for fast lookups",
        "Enable RLS with policy allowing service role only",
        "Create SQL function check_rate_limit(identifier, action, max_attempts, window_seconds) that returns boolean",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-020",
      "title": "Add Content Security Policy headers and security headers audit",
      "description": "As a security engineer, I want production-grade security headers so that the app is protected against XSS, clickjacking, and other common web attacks.",
      "acceptanceCriteria": [
        "Update public/_headers with strict Content-Security-Policy",
        "CSP allows: self, Supabase domain, Sentry domain, Stripe JS, Google Analytics",
        "CSP blocks: inline scripts (use nonce or hash), eval, unsafe-inline styles only where required",
        "Add Permissions-Policy header restricting camera, microphone, geolocation to self",
        "Add Referrer-Policy: strict-origin-when-cross-origin",
        "Verify X-Content-Type-Options: nosniff is present",
        "Verify X-Frame-Options: DENY is present",
        "Verify Strict-Transport-Security header is present with max-age >= 31536000",
        "Typecheck passes"
      ],
      "priority": 20,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-021",
      "title": "Add input sanitization utilities for user-generated content",
      "description": "As a developer, I want centralized input sanitization so that user-generated content is safe from XSS and injection attacks.",
      "acceptanceCriteria": [
        "Create src/lib/sanitize.ts with sanitizeHtml, sanitizeText, and sanitizeUrl functions",
        "sanitizeHtml strips dangerous tags (script, iframe, object, embed) while allowing safe formatting tags",
        "sanitizeText escapes all HTML entities",
        "sanitizeUrl validates against javascript: and data: protocol injection",
        "Add unit tests in src/lib/sanitize.test.ts covering XSS vectors",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 21,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-022",
      "title": "Add CSRF protection for state-changing operations",
      "description": "As a security engineer, I want CSRF protection so that authenticated users cannot be tricked into performing unintended actions.",
      "acceptanceCriteria": [
        "Create src/lib/csrf.ts that generates and validates CSRF tokens",
        "Store CSRF token in session/cookie with SameSite=Strict",
        "Add CSRF token to all POST/PUT/DELETE requests via Supabase client wrapper",
        "Validate CSRF token in edge functions that modify data",
        "Typecheck passes"
      ],
      "priority": 22,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-023",
      "title": "Fix protected route authentication flow and redirects",
      "description": "As a user, I want authenticated routes to properly redirect to login and back so that I don't lose my place when my session expires.",
      "acceptanceCriteria": [
        "Audit ProtectedRoute component in src/App.tsx for correct auth state handling",
        "Store intended destination URL before redirecting to /auth",
        "After successful login, redirect to stored destination (not always /dashboard)",
        "Handle edge case of expired JWT token mid-session with re-auth prompt",
        "Show loading state while checking auth status (not flash of login page)",
        "Verify all 43 routes render correctly when authenticated",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 23,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-024",
      "title": "Add comprehensive unit tests for AppContext state management",
      "description": "As a developer, I want thorough unit tests for AppContext so that state management changes don't introduce regressions.",
      "acceptanceCriteria": [
        "Create src/contexts/AppContext.test.tsx with test suite",
        "Test addFood, updateFood, deleteFood operations with mock Supabase",
        "Test addKid, updateKid, deleteKid operations",
        "Test addRecipe, updateRecipe, deleteRecipe operations",
        "Test addPlanEntry, updatePlanEntry, deletePlanEntry operations",
        "Test addGroceryItem, updateGroceryItem, deleteGroceryItem operations",
        "Test error handling when Supabase calls fail",
        "Test localStorage fallback when offline",
        "Achieve 80%+ coverage for AppContext.tsx",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 24,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-025",
      "title": "Add unit tests for utility modules (utils, platform, seo)",
      "description": "As a developer, I want unit tests for utility functions so that shared helpers are reliable across the app.",
      "acceptanceCriteria": [
        "Create src/lib/utils.test.ts testing cn() and all exported utility functions",
        "Create src/lib/platform.test.ts testing platform detection and storage abstraction",
        "Create src/lib/seo-helpers.test.ts testing SEO utility functions",
        "Each test file achieves 90%+ coverage of its source module",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 25,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-026",
      "title": "Add unit tests for custom hooks",
      "description": "As a developer, I want unit tests for custom hooks so that reusable logic is verified independently.",
      "acceptanceCriteria": [
        "Create src/hooks/useLocalStorage.test.ts testing get, set, and default value behavior",
        "Create src/hooks/useSubscription.test.ts testing subscription state management",
        "Create src/hooks/useReducedMotion.test.ts testing media query detection",
        "Create src/hooks/useInView.test.ts testing intersection observer",
        "Use renderHook from @testing-library/react for all hook tests",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 26,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-027",
      "title": "Add unit tests for authentication flow components",
      "description": "As a developer, I want unit tests for auth components so that login, signup, and password reset are reliable.",
      "acceptanceCriteria": [
        "Create src/pages/Auth.test.tsx testing login form rendering and submission",
        "Test signup form validation (email format, password strength)",
        "Test error state display for invalid credentials",
        "Test loading state during auth operations",
        "Mock Supabase auth methods for isolated testing",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 27,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-028",
      "title": "Add unit tests for admin dashboard components",
      "description": "As a developer, I want unit tests for admin components so that administrative features are verified.",
      "acceptanceCriteria": [
        "Create tests for AlertManager component: renders alerts, handles create/delete",
        "Create tests for FeatureFlagDashboard: renders flags, handles toggle",
        "Create tests for LiveActivityFeed: renders activity items, handles refresh",
        "Create tests for SystemHealthMonitor: renders metrics, displays status indicators",
        "Mock Supabase queries for all admin data fetching",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 28,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-029",
      "title": "Add unit tests for SEO schema components",
      "description": "As a developer, I want unit tests for schema components so that structured data output is valid JSON-LD.",
      "acceptanceCriteria": [
        "Create tests for ArticleSchema: validates JSON-LD output matches schema.org spec",
        "Create tests for RecipeSchema: validates nutrition, ingredients, instructions in output",
        "Create tests for FAQSchema: validates question/answer pairs in output",
        "Create tests for BreadcrumbSchema: validates breadcrumb list structure",
        "Verify all schema components render valid JSON-LD script tags",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 29,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-030",
      "title": "Configure Vitest coverage thresholds and reporting",
      "description": "As a developer, I want enforced test coverage thresholds so that coverage cannot regress below acceptable levels.",
      "acceptanceCriteria": [
        "Update vitest.config.ts to enforce coverage thresholds: lines 70%, functions 70%, branches 65%, statements 70%",
        "Configure coverage to fail CI if thresholds are not met",
        "Add coverage exclusion patterns for generated files (types.ts), test files, and config files",
        "Verify npm run test:coverage runs and reports correctly",
        "Typecheck passes"
      ],
      "priority": 30,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-031",
      "title": "Implement structured logging with log levels",
      "description": "As a DevOps engineer, I want structured JSON logging so that production logs can be parsed and analyzed by log aggregation tools.",
      "acceptanceCriteria": [
        "Update or create src/lib/logger.ts with structured JSON log output",
        "Support log levels: debug, info, warn, error, fatal",
        "Include timestamp, level, message, and context fields in each log entry",
        "In production: output JSON format, suppress debug level",
        "In development: output human-readable format, show all levels",
        "Add request ID correlation support for tracing requests",
        "Replace console.log/error calls in AppContext.tsx with logger calls",
        "Typecheck passes"
      ],
      "priority": 31,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-032",
      "title": "Add database connection pooling and query timeout configuration",
      "description": "As a developer, I want database queries to have timeouts and connection limits so that slow queries don't degrade the app.",
      "acceptanceCriteria": [
        "Update src/integrations/supabase/client.ts to configure realtime connection options",
        "Add global query timeout of 30 seconds for all Supabase queries",
        "Add connection error handling with user-friendly error messages",
        "Configure realtime heartbeat interval to 15 seconds",
        "Add reconnection logic for dropped WebSocket connections",
        "Typecheck passes"
      ],
      "priority": 32,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-033",
      "title": "Add database indexes for frequently queried columns",
      "description": "As a developer, I want optimized database indexes so that common queries perform well at scale.",
      "acceptanceCriteria": [
        "Create migration: supabase/migrations/[timestamp]_performance_indexes.sql",
        "Add composite index on plan_entries (kid_id, date) for meal plan lookups",
        "Add index on grocery_items (household_id, checked) for grocery list filtering",
        "Add index on foods (user_id, category) for food browsing",
        "Add index on recipes (user_id, created_at) for recipe listing",
        "Add index on user_subscriptions (user_id, status) for subscription checks",
        "Add index on login_history (user_id, created_at) for audit log queries",
        "Use CREATE INDEX IF NOT EXISTS to be idempotent",
        "Typecheck passes"
      ],
      "priority": 33,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-034",
      "title": "Optimize bundle splitting for vendor chunks",
      "description": "As a developer, I want optimized bundle splitting so that users download less JavaScript on initial page load.",
      "acceptanceCriteria": [
        "Audit current vite.config.ts manualChunks configuration for correctness",
        "Ensure Three.js and 3D dependencies are in a separate chunk only loaded on landing page",
        "Ensure TipTap editor dependencies are in a separate chunk only loaded on blog pages",
        "Ensure chart libraries (recharts) are in a separate chunk only loaded on dashboard/analytics",
        "Verify no circular dependencies in chunk configuration",
        "Run npm run build and verify chunk sizes are reasonable (no single chunk > 500KB)",
        "Typecheck passes"
      ],
      "priority": 34,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-035",
      "title": "Add Core Web Vitals monitoring component",
      "description": "As a developer, I want real-time Core Web Vitals tracking so that we can monitor and improve user experience metrics.",
      "acceptanceCriteria": [
        "Create src/lib/webVitals.ts using the web-vitals library",
        "Track LCP, FID, CLS, TTFB, and INP metrics",
        "Report metrics to Sentry as custom performance measurements",
        "Add optional console reporting in development mode",
        "Initialize web vitals tracking in src/main.tsx",
        "Typecheck passes"
      ],
      "priority": 35,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-036",
      "title": "Implement service worker for offline support and caching",
      "description": "As a user, I want the app to work offline so that I can view my meal plans and grocery lists without internet.",
      "acceptanceCriteria": [
        "Create public/sw.js service worker with cache-first strategy for static assets",
        "Cache API responses for foods, recipes, kids, and grocery items",
        "Serve cached data when offline with 'offline' banner notification",
        "Register service worker in src/main.tsx",
        "Add network status detection using navigator.onLine",
        "Queue failed mutations for sync when back online",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 36,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-037",
      "title": "Add user data export functionality (GDPR compliance)",
      "description": "As a user, I want to export all my data so that the app complies with GDPR and data portability requirements.",
      "acceptanceCriteria": [
        "Create src/components/settings/DataExport.tsx component",
        "Export button generates JSON file containing all user data: kids, foods, recipes, meal plans, grocery lists",
        "Include data schema version in export for forward compatibility",
        "Show progress indicator during export generation",
        "Add to Settings page navigation",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 37,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-038",
      "title": "Add account deletion functionality (GDPR compliance)",
      "description": "As a user, I want to delete my account and all associated data so that the app complies with GDPR right to erasure.",
      "acceptanceCriteria": [
        "Create src/components/settings/AccountDeletion.tsx component",
        "Require password confirmation before deletion",
        "Show warning dialog listing all data that will be deleted",
        "Call Supabase auth.admin.deleteUser or mark for deletion",
        "Cascade delete all user data (foods, kids, recipes, plans, grocery items)",
        "Redirect to landing page after successful deletion",
        "Add to Settings page below Data Export section",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 38,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-039",
      "title": "Add comprehensive API documentation page",
      "description": "As a developer integrating with EatPal, I want API documentation so that I understand available endpoints, request/response formats, and authentication.",
      "acceptanceCriteria": [
        "Update src/pages/ApiDocs.tsx with comprehensive endpoint documentation",
        "Document all deployed edge functions with request/response schemas",
        "Include authentication requirements (JWT tokens, API keys)",
        "Add example request/response for each endpoint",
        "Include rate limiting information",
        "Organize by feature area (Foods, Recipes, Meal Plans, Admin, Billing)",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 39,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-040",
      "title": "Add GitHub Actions deployment job for Cloudflare Pages",
      "description": "As a DevOps engineer, I want automated deployments so that merges to main are automatically deployed to production.",
      "acceptanceCriteria": [
        "Add deploy job to .github/workflows/ci.yml that runs after successful build",
        "Deploy to Cloudflare Pages using wrangler-action",
        "Only run on pushes to main branch (not PRs)",
        "Require all quality gates to pass before deploy (lint, typecheck, tests, build)",
        "Add deployment URL to GitHub deployment status",
        "Use GitHub secrets for CLOUDFLARE_API_TOKEN and CLOUDFLARE_ACCOUNT_ID",
        "Typecheck passes"
      ],
      "priority": 40,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-041",
      "title": "Add staging environment configuration",
      "description": "As a developer, I want a staging environment so that changes can be tested in a production-like setting before release.",
      "acceptanceCriteria": [
        "Create .env.staging with staging Supabase URL and keys (placeholder values)",
        "Add staging build script to package.json: build:staging",
        "Add staging deploy job to CI that runs on pushes to develop branch",
        "Configure wrangler.toml with staging environment (eatpal-staging project)",
        "Document staging workflow in README or deployment guide",
        "Typecheck passes"
      ],
      "priority": 41,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-042",
      "title": "Add database migration testing to CI pipeline",
      "description": "As a developer, I want migrations tested in CI so that broken migrations are caught before deployment.",
      "acceptanceCriteria": [
        "Add migration-test job to .github/workflows/ci.yml",
        "Use supabase/setup-cli action to install Supabase CLI",
        "Run supabase db start to spin up local Postgres",
        "Run supabase db push to apply all migrations",
        "Verify all 95+ migrations apply cleanly in sequence",
        "Run after lint and typecheck jobs",
        "Typecheck passes"
      ],
      "priority": 42,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-043",
      "title": "Add mobile touch target accessibility fixes",
      "description": "As a mobile user, I want all interactive elements to be easily tappable so that I don't accidentally tap the wrong button.",
      "acceptanceCriteria": [
        "Audit all Button, IconButton, and interactive elements for minimum 44x44px touch targets",
        "Add min-h-11 min-w-11 (44px) to all icon-only buttons across the app",
        "Add adequate padding to small interactive elements (links, checkboxes, toggles)",
        "Fix the 49 touch target violations identified in MOBILE_OPTIMIZATION_ACTION_PLAN.md",
        "Run accessibility tests to verify: npm run test:a11y",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 43,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-044",
      "title": "Fix color contrast ratios for WCAG 2.1 AA compliance",
      "description": "As a user with visual impairments, I want sufficient color contrast so that I can read all text and distinguish interactive elements.",
      "acceptanceCriteria": [
        "Audit all text colors against their backgrounds using WCAG 2.1 AA standards (4.5:1 for normal text, 3:1 for large text)",
        "Fix low-contrast text in muted-foreground, placeholder, and disabled states",
        "Update tailwind.config.ts CSS variable colors if needed to meet ratios",
        "Ensure focus indicators have sufficient contrast (3:1 against adjacent colors)",
        "Run accessibility tests to verify: npm run test:a11y",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 44,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-045",
      "title": "Add keyboard navigation support for all interactive components",
      "description": "As a keyboard-only user, I want to navigate the entire app with keyboard so that I can use all features without a mouse.",
      "acceptanceCriteria": [
        "Add visible focus indicators to all interactive elements (buttons, links, inputs, cards)",
        "Ensure tab order follows logical reading order on all pages",
        "Add keyboard support for modal dialogs (Escape to close, trap focus inside)",
        "Add keyboard support for dropdown menus (Arrow keys to navigate, Enter to select, Escape to close)",
        "Add skip-to-main-content link at top of page layout",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 45,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-046",
      "title": "Add ARIA live regions for dynamic content updates",
      "description": "As a screen reader user, I want to be notified of dynamic content changes so that I know when data loads, errors occur, or actions complete.",
      "acceptanceCriteria": [
        "Add aria-live='polite' region for toast notifications",
        "Add aria-live='assertive' region for error messages",
        "Add aria-busy attribute to loading states in data tables and lists",
        "Add sr-only route change announcements for client-side navigation",
        "Announce successful form submissions to screen readers",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 46,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-047",
      "title": "Complete admin user management interface",
      "description": "As an admin, I want to view and manage user accounts so that I can handle support issues and account administration.",
      "acceptanceCriteria": [
        "Verify src/components/admin/BulkUserManagement.tsx renders user list with search and filter",
        "Add ability to view user details (profile, subscription status, activity)",
        "Add ability to disable/enable user accounts",
        "Add ability to reset user passwords (send reset email)",
        "Add pagination for user list (20 users per page)",
        "Protect with admin role check",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 47,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-048",
      "title": "Complete admin subscription management interface",
      "description": "As an admin, I want to view and manage user subscriptions so that I can handle billing issues and grant complimentary access.",
      "acceptanceCriteria": [
        "Verify src/components/admin/ComplementarySubscriptionManager.tsx is functional",
        "Add subscription overview dashboard showing MRR, churn rate, active subscribers count",
        "Add ability to grant complimentary subscriptions with expiry date",
        "Add ability to extend subscription periods",
        "Add subscription status filter (active, trialing, past_due, canceled)",
        "Display Stripe subscription ID linking to Stripe dashboard",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 48,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-049",
      "title": "Complete system health monitoring dashboard",
      "description": "As an admin, I want real-time system health metrics so that I can identify and respond to issues before they affect users.",
      "acceptanceCriteria": [
        "Verify src/components/admin/SystemHealthMonitor component displays key metrics",
        "Show database connection status (connected/disconnected)",
        "Show API response time (p50, p95, p99 from admin_system_health table)",
        "Show error rate trend (last 24 hours from Sentry)",
        "Show active user count (real-time from Supabase presence)",
        "Add refresh interval of 30 seconds with manual refresh button",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 49,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-050",
      "title": "Add admin alert notification system",
      "description": "As an admin, I want automated alerts so that I'm notified when system metrics exceed thresholds.",
      "acceptanceCriteria": [
        "Verify AlertManager component allows creating alert rules",
        "Support alert types: error_rate_high, response_time_slow, disk_usage_high, subscription_churn_spike",
        "Allow setting threshold values per alert type",
        "Support notification channels: in-app, email (via Resend)",
        "Show alert history with timestamps and resolution status",
        "Add active/inactive toggle per alert rule",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 50,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-051",
      "title": "Add feature flag management to admin dashboard",
      "description": "As an admin, I want to toggle feature flags so that I can gradually roll out features and quickly disable problematic ones.",
      "acceptanceCriteria": [
        "Verify FeatureFlagDashboard component renders flag list",
        "Add ability to create new feature flags with name and description",
        "Add ability to toggle flags on/off globally",
        "Add percentage-based rollout (e.g., enable for 10% of users)",
        "Store flags in Supabase and cache in localStorage for performance",
        "Integrate with useFeatureFlag hook for frontend consumption",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 51,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-052",
      "title": "Add real-time admin activity feed",
      "description": "As an admin, I want to see live user activity so that I can monitor usage patterns and identify issues in real-time.",
      "acceptanceCriteria": [
        "Verify LiveActivityFeed component renders recent activity",
        "Subscribe to admin_live_activity table via Supabase real-time",
        "Display user actions: login, food added, recipe created, meal planned, subscription changed",
        "Show timestamp, user identifier (anonymized), and action type",
        "Add filter by action type",
        "Limit display to last 100 events with auto-scroll",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 52,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-053",
      "title": "Optimize Supabase real-time subscription cleanup",
      "description": "As a developer, I want proper subscription cleanup so that the app doesn't leak memory from orphaned WebSocket connections.",
      "acceptanceCriteria": [
        "Audit all Supabase .channel() and .on() subscriptions in the codebase",
        "Ensure every subscription has a corresponding .unsubscribe() in useEffect cleanup",
        "Add subscription tracking to AppContext with cleanup on unmount",
        "Verify no duplicate subscriptions are created on component re-renders",
        "Add logging for subscription lifecycle events in development mode",
        "Typecheck passes"
      ],
      "priority": 53,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-054",
      "title": "Add React.memo optimization to frequently re-rendered components",
      "description": "As a developer, I want memoized components so that unnecessary re-renders don't degrade performance.",
      "acceptanceCriteria": [
        "Identify high-frequency re-render components using React DevTools profiler patterns",
        "Apply React.memo to meal plan card components",
        "Apply React.memo to food list item components",
        "Apply React.memo to grocery list item components",
        "Apply useMemo to expensive filtered/sorted lists in AppContext consumers",
        "Apply useCallback to event handlers passed as props",
        "Typecheck passes"
      ],
      "priority": 54,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-055",
      "title": "Add loading skeleton components for data-dependent pages",
      "description": "As a user, I want skeleton loading states so that pages feel fast and responsive while data loads.",
      "acceptanceCriteria": [
        "Create src/components/ui/skeleton-layouts.tsx with page-specific skeleton layouts",
        "Add skeleton for Dashboard page (stats cards, meal plan grid, activity feed)",
        "Add skeleton for Planner page (weekly calendar grid with meal slots)",
        "Add skeleton for Recipes page (recipe card grid)",
        "Add skeleton for Grocery page (list with checkboxes)",
        "Replace generic loading spinners with contextual skeletons",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 55,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-056",
      "title": "Add comprehensive E2E test for subscription purchase flow",
      "description": "As a developer, I want E2E tests for the payment flow so that subscription purchases are verified end-to-end.",
      "acceptanceCriteria": [
        "Create tests/subscription-flow.spec.ts with Playwright test",
        "Test navigation from Pricing page to checkout",
        "Test Stripe checkout redirect (using Stripe test mode)",
        "Test checkout success page renders with subscription confirmation",
        "Test subscription status updates in user dashboard",
        "Test subscription cancellation flow",
        "Handle Stripe test card numbers for success and failure scenarios",
        "Tests pass"
      ],
      "priority": 56,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-057",
      "title": "Add comprehensive E2E test for meal planning workflow",
      "description": "As a developer, I want E2E tests for meal planning so that the core feature is verified end-to-end.",
      "acceptanceCriteria": [
        "Create tests/meal-plan-workflow.spec.ts with Playwright test",
        "Test creating a kid profile with allergens",
        "Test adding foods to the food database",
        "Test creating a meal plan entry for a specific day and meal slot",
        "Test viewing the weekly meal plan calendar",
        "Test generating a grocery list from the meal plan",
        "Test marking grocery items as purchased",
        "Tests pass"
      ],
      "priority": 57,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-058",
      "title": "Add production monitoring and alerting documentation",
      "description": "As a DevOps engineer, I want a runbook for production monitoring so that on-call engineers can diagnose and resolve issues quickly.",
      "acceptanceCriteria": [
        "Create docs/runbook.md with production monitoring procedures",
        "Document Sentry alert triage process (P0-P3 severity levels)",
        "Document Cloudflare Pages deployment rollback procedure",
        "Document Supabase database emergency procedures (backup restore, RLS bypass for debugging)",
        "Document Stripe webhook failure recovery steps",
        "Include escalation contacts and communication templates",
        "Include health check endpoint monitoring setup instructions",
        "Typecheck passes"
      ],
      "priority": 58,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-059",
      "title": "Add production deployment checklist",
      "description": "As a release manager, I want a deployment checklist so that releases follow a consistent, safe process.",
      "acceptanceCriteria": [
        "Create docs/deployment-checklist.md with pre-deploy, deploy, and post-deploy steps",
        "Pre-deploy: verify CI passes, review changes, check for migration safety",
        "Deploy: document Cloudflare Pages deploy command, Supabase migration push, edge function deploy",
        "Post-deploy: verify health check, check error rates, validate critical flows",
        "Rollback: document rollback steps for each deployment component",
        "Include environment variable change procedures",
        "Typecheck passes"
      ],
      "priority": 59,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-060",
      "title": "Final production readiness verification and smoke test",
      "description": "As a release manager, I want a final verification that all production readiness items are complete so that we can confidently launch.",
      "acceptanceCriteria": [
        "Run npm run build and verify zero errors",
        "Run npm run test:run and verify all tests pass",
        "Run npm run lint and verify zero warnings",
        "Verify all edge functions have corresponding files in functions/ directory",
        "Verify all environment variables documented in .env.example",
        "Verify security headers in public/_headers are production-ready",
        "Verify error monitoring (Sentry) is configured for production",
        "Verify all database tables have RLS policies enabled",
        "Create PRODUCTION_READY.md summary with sign-off checklist",
        "Typecheck passes"
      ],
      "priority": 60,
      "passes": false,
      "notes": ""
    }
  ]
}
