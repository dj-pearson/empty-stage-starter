{
  "project": "EatPal",
  "branchName": "ralph/platform-hardening-v2",
  "description": "Platform Hardening & Quality Improvements - Comprehensive security remediation, performance optimization, UI/UX consistency fixes, and accessibility improvements identified through a full-spectrum platform audit. Covers critical credential rotation, CORS hardening, SSRF prevention, dependency vulnerability patching, AppContext performance overhaul, bundle optimization, dark mode fixes, form UX standardization, and navigation/feedback consistency.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Remove live credentials from wrangler.toml and rotate keys",
      "description": "As a security engineer, I want all real credentials removed from version-controlled files so that production secrets are not exposed in the git history.",
      "acceptanceCriteria": [
        "Replace the real Supabase anon key in wrangler.toml (line 12 comment) with a placeholder: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.XXXXXXXX",
        "Replace the real Stripe publishable key in wrangler.toml (line 14 comment) with a placeholder: pk_live_XXXXXXXXXXXXXXXX",
        "Search entire codebase for any other real API keys, JWTs, or secrets and replace with placeholders",
        "Verify no .env files are tracked in git",
        "Typecheck passes",
        "npm run build succeeds"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Fix wildcard CORS on all edge functions",
      "description": "As a security engineer, I want CORS restricted to our domain so that third-party websites cannot make authenticated requests to our API.",
      "acceptanceCriteria": [
        "Replace Access-Control-Allow-Origin: * with the production domain https://tryeatpal.com in all edge functions under functions/",
        "Add development origin http://localhost:8080 conditionally based on environment",
        "Create a shared corsHeaders utility in functions/_shared/cors.ts to avoid duplication",
        "All 14+ edge functions use the shared CORS headers",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Add JWT authentication to unauthenticated edge functions",
      "description": "As a security engineer, I want all privileged edge functions to require authentication so that anonymous users cannot consume API credits or write to storage.",
      "acceptanceCriteria": [
        "Add JWT verification to functions/generate-blog-content/index.ts",
        "Add JWT verification to functions/generate-social-content/index.ts",
        "Add JWT verification to functions/update-blog-image/index.ts",
        "Add JWT verification to functions/parse-grocery-image/index.ts",
        "Add JWT verification to functions/parse-recipe/index.ts",
        "Create a shared auth helper in functions/_shared/auth.ts to reduce duplication",
        "All functions return 401 for missing/invalid JWT",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Fix SSRF vulnerabilities in parse-recipe and update-blog-image",
      "description": "As a security engineer, I want server-side URL fetching protected against SSRF so that attackers cannot probe internal networks or cloud metadata endpoints.",
      "acceptanceCriteria": [
        "Add URL validation to functions/parse-recipe/index.ts that blocks private IP ranges (10.x, 172.16-31.x, 192.168.x, 127.x, 169.254.x, fd00::/8, ::1)",
        "Add URL validation to functions/update-blog-image/index.ts with the same private IP blocking",
        "Block cloud metadata URLs (169.254.169.254)",
        "Only allow http: and https: protocols",
        "Add URL domain allowlist or block known dangerous hosts",
        "Create shared URL validation utility in functions/_shared/url-validator.ts",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Fix create-checkout to use JWT user_id instead of client-supplied user_id",
      "description": "As a security engineer, I want the checkout flow to use the verified JWT identity so that users cannot create subscriptions under another user's account.",
      "acceptanceCriteria": [
        "In functions/create-checkout/index.ts, extract user.id from the verified JWT (supabaseClient.auth.getUser())",
        "Use the JWT-derived user_id for Stripe metadata, client_reference_id, and user_subscriptions upsert",
        "Ignore or remove the user_id field from the request body",
        "Return 401 if JWT verification fails",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Fix Stripe webhook signature to use constant-time comparison",
      "description": "As a security engineer, I want webhook signature verification to use constant-time comparison to prevent timing attacks.",
      "acceptanceCriteria": [
        "In functions/stripe-webhook/index.ts, replace the string equality check (computed === expectedSig) with crypto.subtle.timingSafeEqual or equivalent constant-time comparison",
        "Encode both strings to Uint8Array before comparison",
        "Handle length mismatch case securely (return false without leaking info)",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Fix overly permissive RLS INSERT policies on security-critical tables",
      "description": "As a security engineer, I want RLS policies to enforce proper authorization so that users cannot insert arbitrary data into system tables.",
      "acceptanceCriteria": [
        "Create a new Supabase migration file",
        "Fix login_history INSERT policy to require auth.uid() = user_id instead of WITH CHECK (true)",
        "Fix login_history UPDATE policy to require auth.uid() = user_id",
        "Fix security_audit_logs INSERT policy to require auth.uid() IS NOT NULL",
        "Fix rate_limits policy to restrict to service role only (remove FOR ALL USING (true))",
        "Fix automation_email_queue policy to restrict to admin role only",
        "Fix backup_logs policy to restrict to admin role only",
        "Fix blog_comments INSERT to require auth.uid() IS NOT NULL to prevent anonymous spam",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Fix high-severity dependency vulnerabilities",
      "description": "As a developer, I want all critical and high-severity dependency vulnerabilities patched so that the application is not exposed to known exploits.",
      "acceptanceCriteria": [
        "Update react-router-dom to 6.31+ to fix XSS via open redirect (GHSA-2w69-qvjg-hvjx)",
        "Update or replace jspdf to fix path traversal CVE",
        "Remove @modelcontextprotocol/sdk if not used in the web app (has ReDoS + data leak vulns)",
        "Remove jsonwebtoken from dependencies if not imported in src/",
        "Run npm audit and resolve all critical and high vulnerabilities where possible",
        "npm run build succeeds",
        "All existing tests pass"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Fix edge function error messages to not leak internal details",
      "description": "As a security engineer, I want error responses from edge functions to be generic so that internal implementation details are not exposed to attackers.",
      "acceptanceCriteria": [
        "In all edge function catch blocks, return generic error messages to clients: 'Internal server error'",
        "Log detailed error information server-side using console.error",
        "Remove error.message from client-facing 500 responses in all functions/*/index.ts files",
        "Keep 4xx error messages informative but not implementation-specific",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Fix HTML injection in blog content generation template",
      "description": "As a security engineer, I want user-supplied content HTML-escaped before template interpolation so that stored XSS is prevented.",
      "acceptanceCriteria": [
        "In functions/generate-blog-content/index.ts, create an escapeHtml() utility that escapes &, <, >, and \" characters",
        "Apply escapeHtml() to topic and keywords before interpolating into HTML templates",
        "Apply the same escaping in generate-social-content if applicable",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Fix geolocation API call to use HTTPS instead of HTTP",
      "description": "As a security engineer, I want all external API calls to use HTTPS so that data is not exposed to man-in-the-middle attacks.",
      "acceptanceCriteria": [
        "In src/lib/login-history.ts, change http://ip-api.com to https://ip-api.com or switch to an HTTPS-supporting provider",
        "If ip-api.com does not support HTTPS on free tier, switch to ipinfo.io or similar",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Split AppContext into domain-specific contexts for performance",
      "description": "As a developer, I want the monolithic AppContext split into focused domain contexts so that components only re-render when their specific data changes.",
      "acceptanceCriteria": [
        "Create src/contexts/FoodsContext.tsx with foods state, addFood, updateFood, deleteFood, addFoods, updateFoods",
        "Create src/contexts/KidsContext.tsx with kids state, addKid, updateKid, deleteKid, activeKidId, setActiveKidId",
        "Create src/contexts/RecipesContext.tsx with recipes state, addRecipe, updateRecipe, deleteRecipe",
        "Create src/contexts/PlanContext.tsx with planEntries state, addPlanEntry, updatePlanEntry, deletePlanEntry, copyWeekPlan, deleteWeekPlan",
        "Create src/contexts/GroceryContext.tsx with groceryItems state, addGroceryItem, updateGroceryItem, deleteGroceryItem",
        "Keep AppContext as a thin wrapper that re-exports from domain contexts for backward compatibility",
        "Wrap context values in useMemo to prevent unnecessary re-renders",
        "Wrap all handler functions in useCallback",
        "Use functional updater pattern for all setState calls (e.g., setFoods(prev => [...prev, newFood]))",
        "All existing tests pass",
        "Typecheck passes",
        "npm run build succeeds"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Add debounced localStorage persistence and fix stale closure bugs",
      "description": "As a user, I want state updates to be reliable even during rapid interactions so that data is not lost when performing quick successive actions.",
      "acceptanceCriteria": [
        "Debounce the save-to-storage effect in AppContext (or domain contexts) with 500ms delay",
        "Replace all stale closure state updates with functional updater pattern: setFoods(prev => [...prev, newFood]) instead of setFoods([...foods, newFood])",
        "Fix the auth-change data reload to include date-range filtering on plan_entries (same as initial load)",
        "Batch the recipe migration localStorage check to use a single bulk insert instead of individual inserts in a loop",
        "Typecheck passes",
        "All existing tests pass"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Optimize Supabase queries to use column-specific selects and pagination",
      "description": "As a user, I want the app to load quickly even with large datasets so that performance doesn't degrade over time.",
      "acceptanceCriteria": [
        "Replace all .select('*') calls in AppContext/domain contexts with column-specific selects for list views",
        "Add .limit(200) or cursor-based pagination to foods, recipes, and grocery_items queries",
        "Keep plan_entries date-range filtering (already partially implemented)",
        "Add load-more pattern or infinite scroll to Pantry page for foods beyond the initial limit",
        "Typecheck passes",
        "All existing tests pass"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Remove unused dependencies and optimize imports",
      "description": "As a developer, I want unused dependencies removed and imports optimized so that the bundle is smaller and tree-shaking is effective.",
      "acceptanceCriteria": [
        "Remove jsonwebtoken from package.json if not imported in src/",
        "Remove @modelcontextprotocol/sdk from package.json if not imported in src/",
        "Replace react-icons usage in Auth.tsx with inline SVGs or individual icon packages to avoid bundling the entire react-icons library",
        "Replace import * as Sentry with named imports in src/lib/sentry.tsx and src/lib/api-errors.ts",
        "Verify html2canvas and jspdf are dynamically imported (not statically) in their consuming components",
        "npm run build succeeds",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Remove unoptimized PNG files and fix asset preload conflicts",
      "description": "As a developer, I want the public directory optimized so that deployment size is minimized and preloads are correct.",
      "acceptanceCriteria": [
        "Remove splash.png (1.9MB) if splash.webp exists and is used instead",
        "Remove Cover.png (1.9MB) if Cover.webp exists and is used instead",
        "Remove Palette.png (1.3MB) if Palette.webp exists and is used instead",
        "Remove Icon-Large.png (892KB) if Icon-Large.webp exists and is used instead",
        "Remove favicon_io.zip development artifact from public/",
        "Fix conflicting preload: align public/_headers preload with index.html preload (both should reference the same format - prefer .webp)",
        "Remove preload for /assets/fonts/inter-var.woff2 if fonts are loaded from Google CDN",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-017",
      "title": "Switch build minifier from Terser to esbuild and add hidden source maps",
      "description": "As a developer, I want faster builds and working Sentry source maps so that CI is fast and production errors are debuggable.",
      "acceptanceCriteria": [
        "In vite.config.ts, replace minify: 'terser' with minify: 'esbuild'",
        "Replace terserOptions with esbuild: { drop: ['console', 'debugger'] } for production",
        "Change sourcemap from mode === 'development' to 'hidden' for production (generates .map files for Sentry but doesn't expose them to browsers)",
        "Verify Sentry Vite plugin can find and upload source maps",
        "npm run build succeeds",
        "Build time is measurably faster"
      ],
      "priority": 17,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-018",
      "title": "Standardize on Sonner toast and remove duplicate toast system",
      "description": "As a user, I want consistent toast notifications so that feedback looks the same regardless of which feature triggered it.",
      "acceptanceCriteria": [
        "Identify all 23 files importing from @/hooks/use-toast and migrate them to import { toast } from 'sonner'",
        "Remove the shadcn Toaster component from App.tsx (keep only Sonner)",
        "Remove src/hooks/use-toast.ts if no longer imported",
        "Remove src/components/ui/toaster.tsx if no longer imported",
        "All toast calls use the sonner API: toast.success(), toast.error(), toast.loading()",
        "Typecheck passes",
        "All existing tests pass"
      ],
      "priority": 18,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-019",
      "title": "Replace window.confirm() with AlertDialog for destructive actions",
      "description": "As a user, I want confirmation dialogs to match the app's design system so that the experience is consistent and professional.",
      "acceptanceCriteria": [
        "Replace window.confirm() in src/components/AIMealCoach.tsx with AlertDialog from shadcn",
        "Replace window.confirm() in src/components/admin/FeatureFlagDashboard.tsx",
        "Replace window.confirm() in src/components/admin/NutritionManager.tsx",
        "Replace window.confirm() in src/components/admin/PromotionalCampaignManager.tsx",
        "Replace window.confirm() in src/components/admin/PromptTemplateManager.tsx",
        "Replace window.confirm() in src/components/admin/ComplementarySubscriptionManager.tsx",
        "Replace window.confirm() in src/components/admin/UserRolesManager.tsx",
        "Replace window.confirm() in src/pages/dashboard/ProfessionalSettings.tsx",
        "Replace window.confirm() in src/pages/dashboard/Billing.tsx",
        "Replace window.confirm() in src/components/billing/SubscriptionOverview.tsx",
        "All AlertDialogs use destructive variant for delete/cancel actions",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-020",
      "title": "Add confirmation dialogs to unprotected delete actions",
      "description": "As a user, I want a confirmation prompt before irreversible deletions so that I don't accidentally lose data.",
      "acceptanceCriteria": [
        "Add AlertDialog confirmation before delete in src/components/pantry/PantryListItem.tsx (currently calls onDelete directly)",
        "Add AlertDialog confirmation before delete in src/components/EnhancedRecipeCard.tsx (currently calls onDelete directly)",
        "Add AlertDialog confirmation before delete in src/components/admin/AISettingsManager.tsx (handleDeleteModel)",
        "All confirmation dialogs clearly state what will be deleted",
        "Typecheck passes"
      ],
      "priority": 20,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-021",
      "title": "Fix dead links to /notifications and /help routes",
      "description": "As a user, I want all navigation links to work so that I don't encounter 404 pages.",
      "acceptanceCriteria": [
        "Fix NotificationBell component (src/components/subscription/NotificationBell.tsx line 252) - either create a /notifications route or change to an in-app panel/dialog",
        "Fix SupportWidget component (src/components/SupportWidget.tsx line 199) - either create a /help route or change the link to a valid destination",
        "Verify no other navigation links point to nonexistent routes",
        "Typecheck passes"
      ],
      "priority": 21,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-022",
      "title": "Fix hardcoded colors breaking dark mode across 50+ components",
      "description": "As a user, I want the app to look correct in dark mode so that hardcoded white backgrounds and gray text don't create poor contrast.",
      "acceptanceCriteria": [
        "Replace bg-white with bg-background (or bg-card) in src/components/SuccessAnimations.tsx",
        "Replace text-gray-900/600/500 with text-foreground/muted-foreground in SuccessAnimations.tsx",
        "Fix src/components/ProductShowcase3D.tsx hardcoded bg-white, bg-gray-100, to-white gradient",
        "Fix src/components/HarmonizedFoodDisplay.tsx text-gray-600/700/500",
        "Fix src/components/MealSuggestionCard.tsx bg-gray-100 text-gray-700",
        "Fix src/components/admin/BudgetAnalyticsDashboard.tsx bg-gray-200, bg-gray-100, text-gray-800",
        "Fix src/components/admin/SupportPerformanceDashboard.tsx bg-gray-200 progress bars",
        "Fix src/components/admin/ContentOptimizer.tsx bg-gray-100, text-gray-800, bg-gray-50",
        "Replace text-red-500 with text-destructive in src/components/ui/form-field.tsx (lines 53, 62)",
        "Replace border-red-500 with border-destructive in form components (AddFoodDialog, BulkAddFoodDialog, CreateCollectionDialog)",
        "Typecheck passes"
      ],
      "priority": 22,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-023",
      "title": "Fix touch target sizes below 44px minimum on interactive elements",
      "description": "As a mobile user, I want interactive elements large enough to tap accurately so that I don't accidentally hit the wrong button.",
      "acceptanceCriteria": [
        "Increase pantry quantity stepper buttons in src/components/pantry/PantryListItem.tsx from h-6 w-6 to min h-10 w-10",
        "Increase pantry action buttons (edit/delete) from h-7 w-7 to min h-10 w-10",
        "Increase quantity preset buttons in AddFoodDialog.tsx from h-7 to min h-10",
        "Increase delete aisle button in ManageStoreAislesDialog.tsx from h-8 w-8 to min h-10 w-10",
        "Ensure all button size='sm' variants have min-height of 40px (update the button component or add touch-target wrapper)",
        "Typecheck passes"
      ],
      "priority": 23,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-024",
      "title": "Add DialogDescription to all dialogs missing it for accessibility",
      "description": "As a screen reader user, I want dialogs to announce their purpose so that I understand what the dialog is for.",
      "acceptanceCriteria": [
        "Add DialogDescription (can be visually hidden with sr-only) to src/components/AddFoodDialog.tsx",
        "Add DialogDescription to src/components/FoodSelectorDialog.tsx",
        "Add DialogDescription to src/components/QuickSuggestionsPanel.tsx",
        "Add DialogDescription to src/components/RecipeViewWithScaling.tsx",
        "Add DialogDescription to src/components/ReportHistory.tsx",
        "Add DialogDescription to src/components/recipes/InstructionStepBuilder.tsx",
        "Add DialogDescription to src/components/recipes/SmartGroceryDialog.tsx",
        "Add DialogDescription to src/components/ui/form-dialog.tsx",
        "Typecheck passes"
      ],
      "priority": 24,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-025",
      "title": "Consolidate duplicate EmptyState components into a single canonical version",
      "description": "As a developer, I want one consistent EmptyState component so that empty states look uniform across the app.",
      "acceptanceCriteria": [
        "Keep src/components/ui/EmptyState.tsx as the canonical version (it has Card wrapper, preview slot, and proper sizing)",
        "Migrate src/components/EmptyState.tsx specialized variants (EmptyRecipes, EmptyPantry, EmptyGroceryList, EmptyMealPlan, EmptyChildren, EmptySearchResults) to use the canonical version with Lucide icons instead of inline SVGs",
        "Update all imports across the codebase to use the canonical component",
        "Remove the old src/components/EmptyState.tsx after migration",
        "Typecheck passes"
      ],
      "priority": 25,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-026",
      "title": "Consolidate duplicate Breadcrumb components and add to dashboard pages",
      "description": "As a user, I want consistent breadcrumb navigation so that I can easily understand where I am in the app.",
      "acceptanceCriteria": [
        "Consolidate src/components/BreadcrumbNavigation.tsx and src/components/Breadcrumbs.tsx into a single component",
        "Keep the version that generates JSON-LD schema data",
        "Add breadcrumbs to all dashboard pages (18 routes) using generateBreadcrumbsFromPath or manual items",
        "Add breadcrumbs to blog pages (Blog listing, BlogPost detail)",
        "Add breadcrumbs to quiz result pages",
        "Remove the redundant breadcrumb component",
        "Typecheck passes"
      ],
      "priority": 26,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-027",
      "title": "Add autoFocus to primary input in all dialog forms",
      "description": "As a user, I want the cursor to automatically focus the first input when a dialog opens so that I can start typing immediately.",
      "acceptanceCriteria": [
        "Add autoFocus to the primary input in AddFoodDialog",
        "Add autoFocus to CreateGroceryListDialog",
        "Add autoFocus to ManageKidsDialog",
        "Add autoFocus to CreateCollectionDialog",
        "Add autoFocus to BulkAddFoodDialog",
        "Add autoFocus to ImportRecipeDialog",
        "Add autoFocus to SaveMealPlanTemplateDialog",
        "Add autoFocus to CreateStoreLayoutDialog",
        "Typecheck passes"
      ],
      "priority": 27,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-028",
      "title": "Standardize form validation pattern across all forms",
      "description": "As a developer, I want a consistent form validation approach so that error display is uniform and theme-aware.",
      "acceptanceCriteria": [
        "Migrate ManageKidsDialog from toast-only validation to inline field-level errors using FormField or useFormValidation",
        "Ensure all form error indicators use text-destructive and border-destructive (not text-red-500, border-red-500)",
        "Verify AddFoodDialog uses consistent validation pattern with inline errors",
        "All forms show field-level errors adjacent to the problematic field, not just toast messages",
        "Typecheck passes"
      ],
      "priority": 28,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-029",
      "title": "Fix navigation consistency between sidebar and header nav",
      "description": "As a user, I want navigation to be consistent across sidebar and header so that I can find features in the same place regardless of navigation method.",
      "acceptanceCriteria": [
        "Align AppSidebar route groupings with Navigation header groupings (same items in same categories)",
        "Ensure mobile 'More' menu in Navigation includes all routes that AppSidebar shows (Account Settings, Accessibility Settings)",
        "Fix CommandPalette to navigate to /dashboard/* paths instead of convenience aliases to avoid URL inconsistency",
        "Typecheck passes"
      ],
      "priority": 29,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-030",
      "title": "Remove 36 @ts-nocheck suppressions and fix underlying type errors",
      "description": "As a developer, I want TypeScript checking enabled on all files so that type errors are caught at compile time.",
      "acceptanceCriteria": [
        "Remove @ts-nocheck from all 36 files listed in the codebase",
        "Fix the underlying TypeScript errors in each file (add proper types for Supabase tables, replace any with proper types)",
        "If admin tables are not yet in generated types, add type declarations in src/types/ as interim solution",
        "npx tsc --noEmit passes with zero errors",
        "npm run build succeeds"
      ],
      "priority": 30,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-031",
      "title": "Add list virtualization for large data pages",
      "description": "As a user with lots of data, I want the Pantry and Grocery pages to render smoothly so that scrolling is not laggy.",
      "acceptanceCriteria": [
        "Install @tanstack/react-virtual as a dependency",
        "Add virtualized list rendering to Pantry page (src/pages/Pantry.tsx) for the food item list",
        "Add virtualized list rendering to Grocery page for the grocery items list",
        "Maintain existing filter/search/sort functionality with virtualization",
        "Fallback gracefully for lists under 50 items (skip virtualization for small lists)",
        "Typecheck passes"
      ],
      "priority": 31,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-032",
      "title": "Replace framer-motion with CSS transitions on data-heavy list pages",
      "description": "As a user, I want list pages to feel responsive even with many items so that animation overhead doesn't cause jank.",
      "acceptanceCriteria": [
        "Replace framer-motion AnimatePresence + motion.div in Pantry.tsx with CSS transitions/animations",
        "Use CSS @keyframes for enter/exit animations (fade-in, slide-up)",
        "Keep framer-motion for complex orchestrated animations (landing page, onboarding) but not for list item rendering",
        "Remove the framer-motion import from Pantry.tsx",
        "Typecheck passes"
      ],
      "priority": 32,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-033",
      "title": "Fix permanent will-change CSS property on meal items",
      "description": "As a developer, I want GPU memory used efficiently so that the app performs well on low-end devices.",
      "acceptanceCriteria": [
        "In src/index.css, remove will-change: transform, box-shadow from .gsap-meal-item class",
        "Apply will-change only during animation via JavaScript (add before animation starts, remove after completion)",
        "Or use CSS :hover/:active pseudo-selectors to apply will-change only during interaction",
        "Typecheck passes"
      ],
      "priority": 33,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-034",
      "title": "Fix mobile-specific UI issues: hidden badges, nav padding, desktop overflow",
      "description": "As a mobile user, I want all relevant information visible and the UI not cut off so that I have a complete experience on my phone.",
      "acceptanceCriteria": [
        "Show food safety badges on mobile in PantryListItem.tsx (remove hidden sm:flex or replace with responsive layout)",
        "Add pb-16 (or equivalent safe-area padding) to main content area to prevent content being hidden behind the bottom navigation bar",
        "Add horizontal overflow menu or dropdown for desktop header nav when items exceed available width (instead of overflowing)",
        "Typecheck passes"
      ],
      "priority": 34,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-035",
      "title": "Fix CSP to remove unsafe-inline and unsafe-eval where possible",
      "description": "As a security engineer, I want the Content Security Policy hardened so that XSS attacks are mitigated at the browser level.",
      "acceptanceCriteria": [
        "In public/_headers, remove 'unsafe-eval' from script-src if possible (audit which dependencies require it)",
        "If Three.js requires eval, scope the exception narrowly",
        "Remove deprecated Expect-CT header from _headers",
        "Add nonce-based CSP support if Cloudflare Pages supports it, or document why unsafe-inline is still needed",
        "Verify the app still loads correctly with the tightened CSP"
      ],
      "priority": 35,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-036",
      "title": "Wire server-side rate limiting into the login flow",
      "description": "As a security engineer, I want brute-force login prevention enforced server-side so that client-side bypass does not negate rate limiting.",
      "acceptanceCriteria": [
        "In src/pages/Auth.tsx, call the check_rate_limit RPC (supabase.rpc('check_rate_limit', { ... })) before attempting sign-in",
        "If rate limit is exceeded, display the lockout message and prevent the sign-in attempt",
        "Keep client-side rate limiter as a UX-level enhancement (fast feedback)",
        "The server-side check should be the authoritative enforcement",
        "Typecheck passes"
      ],
      "priority": 36,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-037",
      "title": "Remove DOMPurify style attribute allowance in admin email builders",
      "description": "As a security engineer, I want DOMPurify configured to block style attributes so that CSS-based data exfiltration is prevented.",
      "acceptanceCriteria": [
        "Remove 'style' from ALLOWED_ATTR in src/components/admin/EmailSequenceBuilder.tsx DOMPurify config",
        "Remove 'style' from ALLOWED_ATTR in src/components/admin/EmailTemplateBuilder.tsx",
        "If styling is needed, use DOMPurify ALLOW_CSS option with a strict CSS property allowlist",
        "Verify email preview still renders correctly",
        "Typecheck passes"
      ],
      "priority": 37,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-038",
      "title": "Add loading states to dialog submit buttons that lack them",
      "description": "As a user, I want to see feedback when I submit a form so that I know my action is being processed.",
      "acceptanceCriteria": [
        "Add loading spinner to the save button in AddFoodDialog when onSave is in progress",
        "Add loading spinner to the submit button in ManageKidsDialog when addKid/updateKid is in progress",
        "Add disabled state to prevent double-submission during loading",
        "Use the existing LoadingButton component or the Loader2 + disabled pattern",
        "Typecheck passes"
      ],
      "priority": 38,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-039",
      "title": "Consolidate duplicate touch target CSS rules",
      "description": "As a developer, I want touch target sizing defined in one place so that changes are consistent and maintainable.",
      "acceptanceCriteria": [
        "Audit src/index.css and src/styles/mobile-first.css for overlapping touch target rules",
        "Consolidate into a single set of rules in one file",
        "Remove the overly broad blanket rules in mobile-first.css (lines 15-29) that apply min-height/width to ALL buttons, links, and inputs",
        "Replace with targeted utility classes or component-level sizing",
        "Verify touch targets are still appropriately sized on mobile",
        "Typecheck passes"
      ],
      "priority": 39,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-040",
      "title": "Add missing Helmet meta tags to all pages without them",
      "description": "As an SEO specialist, I want every page to have unique title and meta description so that search engines can properly index and display results.",
      "acceptanceCriteria": [
        "Audit all 43 page components for Helmet usage",
        "Add <Helmet> with unique <title> and <meta name='description'> to any pages missing them",
        "Ensure all dashboard pages have descriptive titles in format: 'Page Name - EatPal'",
        "Add Open Graph tags (og:title, og:description) to public-facing pages",
        "Typecheck passes"
      ],
      "priority": 40,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-041",
      "title": "Fix interactive div elements to use proper semantic HTML on Home page",
      "description": "As a keyboard and screen reader user, I want interactive elements to be proper buttons so that I can navigate and activate them with keyboard and assistive technology.",
      "acceptanceCriteria": [
        "Replace the 3 onboarding step <div onClick> elements in src/pages/Home.tsx (lines 226-329) with <button> elements or add role='button', tabIndex={0}, and onKeyDown for Enter/Space",
        "Replace the Quick Action <Card onClick> elements (lines 339, 360) with button-like semantics",
        "Fix the overlay <div onClick> in src/components/GestureTutorial.tsx (line 142) with proper button role and keyboard support",
        "Follow the pattern used in src/components/recipes/RecipeListItem.tsx as a reference implementation",
        "Typecheck passes"
      ],
      "priority": 41,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-042",
      "title": "Fix heading hierarchy on dashboard Home page",
      "description": "As a screen reader user, I want proper heading hierarchy so that I can navigate the page structure efficiently.",
      "acceptanceCriteria": [
        "Add an h1 heading to src/pages/Home.tsx (can be visually hidden with sr-only class if the welcome banner serves as visual heading)",
        "Change h4 headings (lines 240, 276, 314, 347, 368) to h2 for section titles",
        "Ensure heading levels do not skip (h1 > h2 > h3, no h1 > h4 jumps)",
        "Typecheck passes"
      ],
      "priority": 42,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-043",
      "title": "Fix Landing page GSAP animations to respect prefers-reduced-motion",
      "description": "As a user with motion sensitivity, I want scroll animations to be disabled when I request reduced motion so that the landing page doesn't cause discomfort.",
      "acceptanceCriteria": [
        "In src/pages/Landing.tsx, check window.matchMedia('(prefers-reduced-motion: reduce)') before initializing GSAP ScrollTrigger animations (lines 89-146)",
        "If reduced motion is preferred, skip the Y-translation and opacity animations or reduce them to instant state changes",
        "Add reduced-motion media query to the animate-bounce-dynamic CSS class (line 472)",
        "Typecheck passes"
      ],
      "priority": 43,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-044",
      "title": "Fix Pricing page accessibility issues (radiogroup and sr-only contradiction)",
      "description": "As an assistive technology user, I want pricing controls to be properly labeled so that I can understand and interact with billing options.",
      "acceptanceCriteria": [
        "Add role='radio' and aria-checked to child Button elements within the billing cycle toggle role='radiogroup' in src/pages/Pricing.tsx (line 480)",
        "Fix the sr-only + aria-hidden='true' contradiction on line 474 - remove aria-hidden='true' to let screen readers access the content",
        "Typecheck passes"
      ],
      "priority": 44,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-045",
      "title": "Upgrade public lead-magnet pages from Helmet to SEOHead with full metadata",
      "description": "As an SEO specialist, I want high-traffic public pages to have full SEO treatment so that they appear with rich results in search engines.",
      "acceptanceCriteria": [
        "Replace raw <Helmet> with <SEOHead> in src/pages/PickyEaterQuiz.tsx with full OG tags and canonical URL",
        "Replace raw <Helmet> with <SEOHead> in src/pages/BudgetCalculator.tsx with full OG tags and canonical URL",
        "Replace raw <Helmet> with <SEOHead> in src/pages/MealPlanGenerator.tsx with full OG tags and canonical URL",
        "Add appropriate structured data schema components (HowToSchema or SoftwareAppSchema) to these pages",
        "Add noindex meta to authenticated dashboard pages that currently have no Helmet at all",
        "Typecheck passes"
      ],
      "priority": 45,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-046",
      "title": "Audit and fix sitemap.xml for nonexistent routes",
      "description": "As an SEO specialist, I want the sitemap to only contain valid URLs so that search engine crawl budget is not wasted on 404s.",
      "acceptanceCriteria": [
        "Cross-reference all URLs in public/sitemap.xml with routes defined in src/App.tsx",
        "Remove any sitemap entries for routes that do not exist (/features/*, /solutions/*, /resources/*, /about if not defined)",
        "Add any public-facing routes that are missing from the sitemap",
        "Verify the dynamic sitemap edge function (functions/sitemap.xml.ts) has a more complete fallback than just the homepage",
        "Typecheck passes"
      ],
      "priority": 46,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-047",
      "title": "Fix RecipeListItem image alt text for meaningful thumbnails",
      "description": "As a screen reader user, I want recipe images to have descriptive alt text so that I understand what dish is shown.",
      "acceptanceCriteria": [
        "Change alt='' to alt={recipe.name} in src/components/recipes/RecipeListItem.tsx (line 60)",
        "Audit other image components for similar empty alt text on meaningful images",
        "Ensure decorative images retain alt='' (only fix meaningful images)",
        "Typecheck passes"
      ],
      "priority": 47,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-048",
      "title": "Self-host Google Fonts for performance and privacy",
      "description": "As a developer, I want fonts self-hosted so that we eliminate external DNS lookups, improve loading performance, and reduce privacy concerns.",
      "acceptanceCriteria": [
        "Install @fontsource/inter and @fontsource/nunito-sans packages",
        "Import the required font weights (400, 500, 600, 700) in the app entry point",
        "Remove Google Fonts CDN links from index.html (lines 228-248)",
        "Update CSS font-family declarations to reference the local fonts",
        "Verify fonts render correctly",
        "Remove the font preload from public/_headers if it references a CDN path",
        "npm run build succeeds"
      ],
      "priority": 48,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-049",
      "title": "Defer GSAP loading to IntersectionObserver instead of 100ms timer",
      "description": "As a user, I want the landing page to load fast so that JavaScript resources are only loaded when animations will be visible.",
      "acceptanceCriteria": [
        "In src/pages/Landing.tsx, replace the 100ms setTimeout GSAP loading with IntersectionObserver on the first animated section",
        "Only dynamically import GSAP and ScrollTrigger when the animated sections enter the viewport",
        "Maintain existing animation behavior once loaded",
        "Typecheck passes"
      ],
      "priority": 49,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-050",
      "title": "Add aria-live regions to major feature pages for dynamic content updates",
      "description": "As a screen reader user, I want to be notified when data changes on the page so that I don't miss important updates.",
      "acceptanceCriteria": [
        "Add aria-live='polite' region or use AccessibleLoading for loading/data states on Pantry page (food add/delete feedback)",
        "Add aria-live announcements on Grocery page for item checking/unchecking",
        "Add aria-live announcements on Kids page for profile updates",
        "Add aria-live announcement on Planner page for meal plan generation results",
        "Verify sonner toast library provides its own aria-live region (if not, add one)",
        "Typecheck passes"
      ],
      "priority": 50,
      "passes": false,
      "notes": ""
    }
  ]
}